{% extends "base.html" %}
{% block content %}
<!-- Logo in top left corner -->
<div class="absolute top-6 left-6">
  <a href="{{ url_for('main.home') }}" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
    <img
      src="{{ url_for('static', filename='img/turt1-removebg-preview.svg') }}"
      alt="Turtle Trips logo"
      class="h-12"
    />
    <span class="text-lg font-extrabold title-lower-serif">turtle trips.</span>
  </a>
</div>

<section class="pt-8 sm:pt-12 max-w-3xl mx-auto">
  <h2 class="text-xl font-semibold text-center mb-8 text-slate-700">
    trip questions.
  </h2>

  {# Trip Summary Card #}
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5 mb-8">
    <h2 class="text-sm font-semibold uppercase tracking-wider text-slate-500 mb-4">your trip</h2>
    <div class="space-y-3 text-sm">
      <div class="flex justify-between items-center">
        <span class="text-slate-600">destination</span>
        <span class="font-semibold text-base">{{ data.get('city','') }}, {{ data.get('country','') }}</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-600">duration</span>
        <span class="font-semibold text-base">{{ data.get('days','') }} days</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-600">dates</span>
        <span class="font-semibold text-base">{{ data.get('start_date','') }} → {{ data.get('end_date','') }}</span>
      </div>
    </div>
  </div>

  {# Questions Form #}
  <form id="q-form" method="post" action="{{ url_for('main.generate') }}" class="space-y-8">
    
    <!-- Budget -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
      <label class="block text-base font-semibold mb-4">budget per day</label>
      <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$" required>
          <span class="budget-label">
            <span class="text-lg">$</span>
            <span class="text-xs">shoestring</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$">
          <span class="budget-label">
            <span class="text-lg">$$</span>
            <span class="text-xs">budget</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$">
          <span class="budget-label">
            <span class="text-lg">$$$</span>
            <span class="text-xs">comfortable</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$$">
          <span class="budget-label">
            <span class="text-lg">$$$$</span>
            <span class="text-xs">splurge</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$$$">
          <span class="budget-label">
            <span class="text-lg">$$$$$</span>
            <span class="text-xs">luxury</span>
          </span>
        </label>
      </div>
    </div>

    <!-- Interests -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
      <label class="block text-base font-semibold mb-4">interests <span class="text-xs font-normal text-slate-500">(select all that apply)</span></label>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        {% for tag in [
          'nature','food','history & culture','nightlife','shopping',
          'outdoors/adventure','museums','beaches','family-friendly',
          'photography','iconic sights','hidden gems'
        ] %}
        <label class="interest-option">
          <input type="checkbox" name="interests" value="{{ tag }}">
          <span class="interest-label">{{ tag }}</span>
        </label>
        {% endfor %}
      </div>
    </div>

 <!-- Travel Pace -->
<!-- Travel Pace -->
<div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
  <label class="block text-base font-semibold mb-4">travel pace</label>
  <div class="grid grid-cols-3 gap-3">
    <label class="pace-option">
      <input type="radio" name="pace" value="chill">
      <span class="pace-label">
        <img src="{{ url_for('static', filename='img/turt4-removebg-preview.png') }}" alt="Chill pace" class="h-24 w-full object-contain">
        <span class="text-sm">chill</span>
      </span>
    </label>
    <label class="pace-option">
      <input type="radio" name="pace" value="balanced" checked>
      <span class="pace-label">
        <img src="{{ url_for('static', filename='img/turt-run-removebg-preview.png') }}" alt="Balanced pace" class="h-24 w-full object-contain">
        <span class="text-sm">balanced</span>
      </span>
    </label>
    <label class="pace-option">
      <input type="radio" name="pace" value="packed">
      <span class="pace-label">
        <img src="{{ url_for('static', filename='img/turt-sprint-removebg-preview.png') }}" alt="Packed pace" class="h-24 w-full object-contain">
        <span class="text-sm">packed</span>
      </span>
    </label>
  </div>
</div>

  <!-- Additional Details -->
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5 space-y-5">
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">must see</label>
      <textarea
        name="must_see"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="spots or experiences you really want..."></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">must avoid</label>
      <textarea
        name="must_avoid"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="things to skip or sensitivities..."></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">other notes</label>
      <textarea
        name="notes"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="dietary needs, mobility, vibe, etc."></textarea>
    </div>
  </div>

    <!-- Hidden payload -->
    <input type="hidden" name="payload" id="payload">

    <!-- Actions -->
    <div class="flex items-center justify-between pt-4">
      <a href="{{ url_for('main.home') }}" class="px-6 py-3 bg-black text-white rounded-full text-sm font-medium hover:bg-slate-800 transition-all transform hover:scale-105"">
        ← back
      </a>
      <button type="submit" class="px-6 py-3 bg-black text-white rounded-full text-sm font-medium hover:bg-slate-800 transition-all transform hover:scale-105">
        generate itinerary →
      </button>
    </div>
  </form>
</section>


{% endblock %}

{% block scripts %}
<script>
  // Update footer year
  document.getElementById('footer-year').textContent = new Date().getFullYear();

  // base trip bits coming in from the calendar redirect
  const basePayload = {
    country: "{{ (data.get('country') or '')|e }}",
    country_code: "{{ (data.get('country_code') or '')|e }}",
    city: "{{ (data.get('city') or '')|e }}",
    destination: "{{ (data.get('destination') or '')|e }}",
    start_date: "{{ (data.get('start_date') or '')|e }}",
    end_date: "{{ (data.get('end_date') or '')|e }}",
    days: "{{ (data.get('days') or '')|e }}"
  };

  document.getElementById('q-form').addEventListener('submit', (e) => {
    // gather answers
    const fd = new FormData(e.target);
    const interests = [];
    for (const el of e.target.querySelectorAll('input[name="interests"]:checked')) interests.push(el.value);

    const merged = {
      ...basePayload,
      budget_tier: fd.get('budget_tier') || '',
      pace: fd.get('pace') || 'balanced',
      interests,
      must_see: (fd.get('must_see') || '').trim(),
      must_avoid: (fd.get('must_avoid') || '').trim(),
      notes: (fd.get('notes') || '').trim()
    };

    document.getElementById('payload').value = JSON.stringify(merged);
  });
</script>
{% endblock %}