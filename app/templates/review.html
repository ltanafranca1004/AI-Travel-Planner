{% extends "base.html" %}
{% block content %}
<div id="navbar" class="fixed top-0 left-0 w-full z-50 bg-[#FFEFEF] backdrop-blur-sm shadow-sm">
  <div class="max-w-7xl mx-auto px-6 py-2 flex items-center gap-2">
    <a href="{{ url_for('main.home') }}" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
      <img
        src="{{ url_for('static', filename='img/turt-logo.png') }}"
        alt="Turtle Trips logo"
        class="h-14 w-auto"  
        />
      <span class="text-xl font-extrabold title-lower-serif tracking-tight title-3d">turtle trips.</span>
    </a>
  </div>
  <div class="navbar-underline h-[1px] w-full bg-black/20"></div>
</div>

<!-- Add top padding to account for fixed navbar -->
<section class="pt-24 pb-15 sm:pt-28 max-w-3xl mx-auto">
  <h2 class="text-3xl mb-12 sm:text-4xl font-extrabold text-center tracking-tight title-lower-serif fade-in title-3d">
   trip questions.
</h2>

  {# Trip Summary Card #}
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5 mb-8">
    <h2 class="text-sm font-semibold uppercase tracking-wider text-slate-500 mb-4">your trip</h2>
    <div class="space-y-3 text-sm">
      <div class="flex justify-between items-center">
        <span class="text-slate-600">destination</span>
        <span class="font-semibold text-base">{{ data.get('city','') }}, {{ data.get('country','') }}</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-600">duration</span>
        <span class="font-semibold text-base">{{ data.get('days','') }} days</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-600">dates</span>
        <span class="font-semibold text-base">{{ data.get('start_date','') }} → {{ data.get('end_date','') }}</span>
      </div>
    </div>
  </div>

  {# Questions Form #}
  <form id="q-form" method="post" action="{{ url_for('main.generate') }}" class="space-y-8">
    
    <!-- Budget -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
      <label class="block text-base font-semibold mb-4">budget per day</label>
      <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$" required>
          <span class="budget-label">
            <span class="text-lg">$</span>
            <span class="text-xs">shoestring</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$">
          <span class="budget-label">
            <span class="text-lg">$$</span>
            <span class="text-xs">budget</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$">
          <span class="budget-label">
            <span class="text-lg">$$$</span>
            <span class="text-xs">comfortable</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$$">
          <span class="budget-label">
            <span class="text-lg">$$$$</span>
            <span class="text-xs">splurge</span>
          </span>
        </label>
        <label class="budget-option">
          <input type="radio" name="budget_tier" value="$$$$$">
          <span class="budget-label">
            <span class="text-lg">$$$$$</span>
            <span class="text-xs">luxury</span>
          </span>
        </label>
      </div>
    </div>

    <!-- Interests -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
      <label class="block text-base font-semibold mb-4">interests <span class="text-xs font-normal text-slate-500">(select all that apply)</span></label>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        {% for tag in [
          'nature','food','history & culture','nightlife','shopping',
          'outdoors/adventure','museums','beaches','family-friendly',
          'photography','iconic sights','hidden gems'
        ] %}
        <label class="interest-option">
          <input type="checkbox" name="interests" value="{{ tag }}">
          <span class="interest-label">{{ tag }}</span>
        </label>
        {% endfor %}
      </div>
    </div>

<!-- Travel Pace -->
<div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5">
  <label class="block text-base font-semibold mb-4">travel pace</label>
  <div class="grid grid-cols-3 gap-3">
    <!-- Chill -->
    <label class="pace-option">
      <input type="radio" name="pace" value="chill">
      <span class="pace-label flex flex-col items-center">
        <div class="h-24 w-full flex items-center justify-center">
          <img src="{{ url_for('static', filename='img/turt1-removebg-preview.png') }}"
               alt="Chill pace"
               class="max-h-full max-w-full object-contain">
        </div>
        <span class="text-sm mt-1">chill</span>
      </span>
    </label>

    <!-- Balanced -->
    <label class="pace-option">
      <input type="radio" name="pace" value="balanced" checked>
      <span class="pace-label flex flex-col items-center">
        <div class="h-24 w-full flex items-center justify-center">
          <img src="{{ url_for('static', filename='img/turt-run-removebg-preview.png') }}"
               alt="Balanced pace"
               class="max-h-full max-w-full object-contain">
        </div>
        <span class="text-sm mt-1">balanced</span>
      </span>
    </label>

    <!-- Packed -->
    <label class="pace-option">
      <input type="radio" name="pace" value="packed">
      <span class="pace-label flex flex-col items-center">
        <div class="h-24 w-full flex items-center justify-center">
          <img src="{{ url_for('static', filename='img/turt-sprint-removebg-preview.png') }}"
               alt="Packed pace"
               class="max-h-full max-w-full object-contain">
        </div>
        <span class="text-sm mt-1">packed</span>
      </span>
    </label>
  </div>
</div>




  <!-- Additional Details -->
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-sm border border-black/5 space-y-5">
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">must see</label>
      <textarea
        name="must_see"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="spots or experiences you really want..."></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">must avoid</label>
      <textarea
        name="must_avoid"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="things to skip or sensitivities..."></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2 text-slate-700">other notes</label>
      <textarea
        name="notes"
        class="search-bar-outline w-full h-24 resize-none"
        placeholder="dietary needs, mobility, vibe, etc."></textarea>
    </div>
  </div>

    <!-- Hidden payload -->
    <input type="hidden" name="payload" id="payload">

    <!-- Actions -->
    <div class="flex items-center justify-between pt-4">
      <a href="{{ url_for('main.home') }}" class="px-6 py-3 bg-black text-white rounded-full text-sm font-medium hover:bg-slate-800 transition-all transform hover:scale-105"">
        ← back
      </a>
      <button type="submit" class="px-6 py-3 bg-black text-white rounded-full text-sm font-medium hover:bg-slate-800 transition-all transform hover:scale-105">
        generate itinerary →
      </button>
    </div>
  </form>
</section>

 <div id="turtle-mascot-wrapper" 
     class="fixed bottom-12 z-50 flex flex-col items-center transition-all duration-300"
     style="right: 3.9rem; left: auto;"> <!-- move to bottom-right -->
  <div id="turtle-speech" class="mb-2 max-w-xs px-4 py-2 bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm text-sm font-medium font-montserrat text-slate-800 text-center">
    <!-- text will be set by JS -->
  </div>
  <img 
    id="turtle-mascot" 
    src="{{ url_for('static', filename='img/ponder.png') }}" 
    alt="Turtle Mascot" 
    class="h-44 w-auto pointer-events-none"
  />
</div>


<div id="loading-overlay" class="fixed inset-0 bg-white/90 z-50 flex flex-col items-center justify-center hidden">
  <!-- Wait image -->
  <img 
    src="{{ url_for('static', filename='img/wait.png') }}"
    alt="Loading turtle"
    class="h-64 w-auto mb-4"
  />
  
  <!-- Loading bar container -->
    <div class="loader mb-4"></div>

  
  <!-- Loading text -->
 <p class="text-3xl mb-12 sm:text-2xl font-extrabold text-center tracking-tight title-lower-serif fade-in ">
   slowly but surely, planning your adventure...
</p>

</div>

{% endblock %}

{% block scripts %}
<script>
  // Update footer year
  document.getElementById('footer-year').textContent = new Date().getFullYear();

document.getElementById('q-form').addEventListener('submit', (e) => {
  // Show the loading overlay
  const overlay = document.getElementById('loading-overlay');
  overlay.classList.remove('hidden');

  // gather answers
  const fd = new FormData(e.target);
  const interests = Array.from(e.target.querySelectorAll('input[name="interests"]:checked')).map(el => el.value);

  const merged = {
    ...basePayload,
    budget_tier: fd.get('budget_tier') || '',
    pace: fd.get('pace') || 'balanced',
    interests,
    must_see: (fd.get('must_see') || '').trim(),
    must_avoid: (fd.get('must_avoid') || '').trim(),
    notes: (fd.get('notes') || '').trim()
  };

  document.getElementById('payload').value = JSON.stringify(merged);

  // let the form submit normally (overlay stays until next page loads)
});

  // base trip bits coming in from the calendar redirect
  const basePayload = {
    country: "{{ (data.get('country') or '')|e }}",
    country_code: "{{ (data.get('country_code') or '')|e }}",
    city: "{{ (data.get('city') or '')|e }}",
    destination: "{{ (data.get('destination') or '')|e }}",
    start_date: "{{ (data.get('start_date') or '')|e }}",
    end_date: "{{ (data.get('end_date') or '')|e }}",
    days: "{{ (data.get('days') or '')|e }}"
  };

  document.getElementById('q-form').addEventListener('submit', (e) => {
    // gather answers
    const fd = new FormData(e.target);
    const interests = [];
    for (const el of e.target.querySelectorAll('input[name="interests"]:checked')) interests.push(el.value);

    const merged = {
      ...basePayload,
      budget_tier: fd.get('budget_tier') || '',
      pace: fd.get('pace') || 'balanced',
      interests,
      must_see: (fd.get('must_see') || '').trim(),
      must_avoid: (fd.get('must_avoid') || '').trim(),
      notes: (fd.get('notes') || '').trim()
    };

    document.getElementById('payload').value = JSON.stringify(merged);
  });

   document.addEventListener('DOMContentLoaded', () => {
    const mascotWrapper = document.getElementById('turtle-mascot-wrapper');
    const speechEl = document.getElementById('turtle-speech');
    const footer = document.querySelector('footer');

 const phrases = [
  "shell we decide this one?", 
  "turtley wise choice!", 
  "choose like a champ!", 
  "every pick counts, fin-tastic!", 
  "slow and steady wins the day!", 
  "this choice is turtley awesome!", 
  "let`s make waves with that decision!", 
  "you`re on the right shell!", 
  "go on, pick it!", 
  "adventure awaits your choice!"
];



    speechEl.textContent = phrases[Math.floor(Math.random() * phrases.length)];

    window.addEventListener('scroll', () => {
      if (!mascotWrapper || !footer) return;
      const footerRect = footer.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      const overlap = windowHeight - footerRect.top;
      mascotWrapper.style.bottom = overlap > 0 ? `${overlap + 24}px` : '3rem';
    });
  });
</script>
{% endblock %}